Script started on Fri Mar 21 16:49:17 2014
]0;g3yangyl@b2210-23:~/209exercise/e7b2210-23:~/209exercise/e7$ gdb bufserver
GNU gdb (Ubuntu/Linaro 7.4-2012.04-0ubuntu2.1) 7.4-2012.04
Copyright (C) 2012 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
For bug reporting instructions, please see:
<http://bugs.launchpad.net/gdb-linaro/>...
Reading symbols from /h/u12/g4/00/g3yangyl/209exercise/e7/bufserver...done.
(gdb) break main
Breakpoint 1 at 0x400a94: file bufserver.c, line 63.
(gdb) step
The program is not being run.
(gdb) run
Starting program: /h/u12/g4/00/g3yangyl/209exercise/e7/bufserver 

Breakpoint 1, main () at bufserver.c:63
63	int main(void) {
(gdb) step
75	  listenfd = setup();
(gdb) s set  tep
setup () at bufserver.c:11
11	int setup (void) {
(gdb) se tep
12	  int on = 1, status;
(gdb) step
15	  if ((listenfd = socket(AF_INET, SOCK_STREAM, 0)) == -1) {
(gdb) step
socket () at ../sysdeps/unix/syscall-template.S:82
82	../sysdeps/unix/syscall-template.S: No such file or directory.
(gdb) step
socket () at ../sysdeps/unix/syscall-template.S:83
83	in ../sysdeps/unix/syscall-template.S
(gdb) set  tep
setup () at bufserver.c:23
23	                      (const char *) &on, sizeof(on));
(gdb) step
22	  status = setsockopt(listenfd, SOL_SOCKET, SO_REUSEADDR,
(gdb) step
setsockopt () at ../sysdeps/unix/syscall-template.S:82
82	../sysdeps/unix/syscall-template.S: No such file or directory.
(gdb) step
setsockopt () at ../sysdeps/unix/syscall-template.S:83
83	in ../sysdeps/unix/syscall-template.S
(gdb) se tep
setup () at bufserver.c:24
24	  if(status == -1) {
(gdb) step
28	  memset(&self, '\0', sizeof(self));
(gdb) step
29	  self.sin_family = AF_INET;
(gdb) se tep
30	  self.sin_addr.s_addr = INADDR_ANY;
(gdb) step
31	  self.sin_port = htons(PORT);
(gdb) n
32	  printf("Listening on %d\n", PORT);
(gdb) n
Listening on 30001
34	  if (bind(listenfd, (struct sockaddr *)&self, sizeof(self)) == -1) {
(gdb) n
39	  if (listen(listenfd, 5) == -1) {
(gdb) n
43	  return listenfd;
(gdb) n
44	}
(gdb) n
main () at bufserver.c:77
77	    socklen = sizeof(peer);
(gdb) n
78	    if ((fd = accept(listenfd, (struct sockaddr *)&peer, &socklen)) < 0) {
(gdb) n
n
n
82	      printf("New connection on port %d\n", ntohs(peer.sin_port));
(gdb) n
New connection on port 52753
85	      inbuf = 0;          // buffer is empty; has no bytes
(gdb) n
86	      room = sizeof(buf); // room == capacity of the whole buffer
(gdb) n
87	      after = buf;        // start writing at beginning of buf
(gdb) n
89	      while ((nbytes = read(fd, after, room)) > 0) {
(gdb) n
n
139	      close (fd);
(gdb) n
141	  }
(gdb) q
A debugging session is active.

	Inferior 1 [process 3066] will be killed.

Quit anyway? (y or n) y
]0;g3yangyl@b2210-23:~/209exercise/e7b2210-23:~/209exercise/e7$ exit
exit

Script done on Fri Mar 21 16:52:04 2014
